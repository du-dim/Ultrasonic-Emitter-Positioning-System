
# Ultrasonic Emitter Positioning System Based on TDC7200 with Adaptive Logic and Threshold Control

## 📌 Abstract
Ultrasonic Testing (UT) is a widely used non-destructive testing method in industries, particularly for weld inspection and thickness measurement. A key limitation of traditional ultrasonic testing using an angled transducer, especially during manual scanning, is the absence of localization or precise positioning of the piezoelectric transducer (PET) in space. To address this, a PET positioning system architecture has been proposed, enabling the registration of its coordinates during each measurement.

---

## 📑 Table of Contents

1. [Introduction](#1-introduction)
2. [Microcontroller and System Architecture](#2-microcontroller-and-system-architecture)
3. [TDC7200 Operating Mode and Measurement Range](#3-tdc7200-operating-mode-and-measurement-range)  
4. [Working with Ultrasonic Pulse Packets](#4-working-with-ultrasonic-pulse-packets)  
5. [Data Storage and Analysis from TDC7200 (on Arduino Due)](#5-data-storage-and-analysis-from-tdc7200-on-arduino-due)
6. [Determining the Speed of Sound in Air](#6-determining-the-speed-of-sound-in-air)
7. [Applications in Inspection and Positioning](#7-applications-in-inspection-and-positioning)  
8. [Algorithms and Logic](#8-algorithms-and-logic)  
9. [System Advantages](#9-system-advantages)  
10. [Limitations and Operational Features](#10-limitations-and-operational-features)  
11. [Conclusion](#11-conclusion)   
    [Related Materials](#related-materials)   
    [Author](#author)  

---

## 1. Introduction

Positioning the ultrasonic piezoelectric transducer (PET)—a key element of non-destructive metal testing—is critical for weld inspection and other tasks where it is essential to distinguish real defects from false reflections. These PETs typically operate in the **1–15 MHz** range and are used for thickness measurement, defect detection, and other testing purposes.

However, during manual scanning on flat or especially curved surfaces, the spatial position of the PET remains unknown, complicating result interpretation. To resolve this issue, an auxiliary **PET positioning system** has been developed, based on registering ultrasonic pulses in the **40 kHz** range.

The system consists of a miniature **40 kHz transmitter** (e.g., MA40S4S) attached to the PET housing and **several 40 kHz receivers** (e.g., MA40S4R) located outside the control zone. During each measurement, the primary system simultaneously generates a burst of signals from the transmitter. Using the time-of-flight to the receivers and the known speed of sound in air, the system calculates the PET coordinates.

The hardware is built around the **TDC7200** chip, which offers time interval measurement resolution down to **55 ps**, enabling high-precision delay measurements between START and STOP signals.  
Source: [TI TDC7200 Datasheet](https://www.ti.com/lit/gpn/TDC7200)

To extend capabilities, **Mode 2** is used, supporting measurements up to **8 ms**, corresponding to distances up to ~2.7 m in air (depending on temperature and humidity).

The first `START` pulse is generated by the microcontroller (**Arduino Due**), and subsequent pulses are generated **hardware-based**—using the `INTB` signal triggered at the end of each measurement cycle. This signal passes through an **inverter** and a **logical AND gate**, then merges via an **OR gate** with the controller’s control signal.

> This logic eliminates software delays and achieves measurement frequencies of up to 16–20 kHz.

A comparator determines the signal arrival moment, featuring an **adaptive threshold** adjustable via the controller’s `DAC`. The threshold adapts to conditions, such as the number of received pulses and intervals between them.

Intervals between 40 kHz pulses are ~25 µs. If a gap exceeding 50 µs is detected between `STOP` signals, the measurement is considered complete.

The system also integrates a digital **temperature and humidity sensor** (e.g., **SHT31**) via the I²C interface, accounting for the influence of atmospheric conditions on the speed of sound.

> The speed of sound in air depends on both temperature and humidity, affecting positioning accuracy.

It is noteworthy that the **TRIGG output** of TDC7200 is **not used** in this architecture. All cycles are controlled via `START` and `INTB`, and Mode 2 eliminates additional timing constraints associated with TRIGG.

![Group 4](https://github.com/user-attachments/assets/4114279d-b7cd-4225-9f93-b09ea78f0ebb)
*Fig. 1: Control Architecture: Connections between Arduino Due, TDC7200, Comparator, Logic, Temperature/Humidity Sensor, and 40 kHz Ultrasonic Sensors*

---

## 2. Microcontroller and System Architecture

The central control of the system is performed by the **Arduino Due** microcontroller, selected for its high clock speed, built-in DAC, sufficient number of digital outputs, and convenient SPI and I²C interface support.

### 🔁 Overall Structure

The complete architecture covers the entire signal path—from ultrasonic generation to reception and precise time-of-flight measurement:

```text
Arduino DUE → MOSFET → Transmitter → Air → Receiver
→ Amplifier → Comparator → TDC7200 → SPI → Arduino DUE
```

### 📡 2.1. Ultrasonic Transmitter

The transmitter (e.g., MA40S4S) generates a packet of ultrasonic pulses at **40 kHz**. These pulses are created by the Arduino and amplified through a **MOSFET transistor** (e.g., IRLZ44N) connected to a 12V power source. This amplification is necessary to ensure sufficient acoustic signal power.

* The MOSFET is controlled by a digital output from the Arduino.
* The packet typically consists of 3–12 pulses, each 12.5 µs long (half period of 40 kHz).

### 📥 2.2. Receiver

The receiver (e.g., MA40S4R) detects the reflected or direct ultrasonic signal. The output signal from the receiver is fed into a multi-stage **operational amplifier circuit** (e.g., OPA134 or OPA4134), designed to work with single-supply power and to amplify weak signals (from a few mV to hundreds of mV).

* The amplification is configured so that the output signal stays within 3.3V, which is safe for further processing.

### ⚖️ 2.3. Comparator

The amplified analog signal is applied to the input of a **high-speed comparator** (e.g., TLV3501), whose threshold is set via the **Arduino Due's DAC**. The comparator compares the input signal to the threshold and generates a digital edge whenever the threshold is exceeded.

* The digital output of the comparator is connected to the **STOP** input of the **TDC7200** chip.
* The threshold can adapt in real-time depending on the stability of the received pulse packet.

### ⏱ 2.4. TDC7200 Chip

The **TDC7200** chip measures the time interval between a **START** and one or more **STOP** signals. **Mode 2** is used, which allows only one STOP signal per START but supports a maximum measurement time of **8 ms**, allowing measurement of distances up to **2.7 meters**.

* The initial START pulse is generated by the Arduino.
* Subsequent START pulses are generated **in hardware** based on the **INTB** signal after each measurement completes.

### 🧠 2.5. Microcontroller (Arduino Due)

The microcontroller performs several roles:

* **SPI** — for configuring the TDC7200 and reading measurement results.
* **DAC** — for setting the comparator threshold.
* **I²C** — for connecting a temperature and humidity sensor (e.g., SHT31).
* **Digital outputs** — for generating ultrasonic excitation packets, logic control of START, and an EN flag for enabling logic circuitry.

An additional **trigger logic** is implemented:

* `INTB` → Inverter → AND + EN → OR → `START`
* The Arduino can also send START via the same OR line.

### 🌡 2.6. Temperature and Humidity Sensor

A digital sensor (e.g., **SHT31**) connected via I²C is used to correct the speed of sound. Its readings are used to refine distance calculations using known formulas for sound speed dependence on temperature and humidity.

> 🛈 The overall architecture diagram is shown at the end of the "Introduction" section (Fig. 1).

---

## 3. TDC7200 Operating Mode and Measurement Range

### 3.1. Selecting the TDC7200 Mode and Maximum Measurable Distance

The **TDC7200** chip supports two modes for measuring the time between START and STOP pulses:

| Mode | STOP Count | Measurement Time | Resolution  | Min. Interval | Application                                    |
| ---- | ---------- | ---------------- | ----------- | ------------- | ---------------------------------------------- |
| 1    | up to 5    | up to 500 ns     | up to 55 ps | > 12 ns       | High-precision measurement of short intervals  |
| 2    | only 1     | up to 8 ms       | up to 55 ps | > 250 ns      | Long-distance measurement (up to 2.7 m in air) |

For ultrasonic positioning in air (e.g., at 40 kHz), **Mode 2** is chosen because it allows tracking signal delays up to 8 ms, sufficient to capture signals traveling up to **\~2.7 m**:

$$
d_{\text{max}} = v \cdot t_{\text{max}} = 343 \cdot 0.008 = 2.744\ \text{m}
$$

### 3.2. Minimum Measurable Distance

Since TDC7200 in Mode 2 captures only the **first** STOP signal after a START, the duration of the pulse packet and system delays must be considered to avoid falling into a "dead zone."

Formula:

$$
d_{\text{min}} = (t_{\text{packet}} + t_{\text{delay}}) \cdot v
$$

| Number of Pulses | Packet Duration (µs) | Delay (µs) | Minimum Distance (mm) |
| ---------------- | -------------------- | ---------- | --------------------- |
| 10               | 225                  | 5          | ≈78.3                 |
| 5                | 100                  | 5          | ≈36.2                 |
| 3                | 50                   | 5          | ≈18.8                 |

> Reducing the number of pulses lowers the minimum measurable distance to around **20 mm**.

### 3.3. Packet Length Adaptation

To improve flexibility and robustness, the controller can adapt the number of pulses based on a preliminary delay estimate:

| Delay      | Pulses |
| ---------- | ------ |
| < 300 µs   | 3–5    |
| 300–500 µs | 6–8    |
| > 500 µs   | 10–12  |

A **trial series** of 3–5 measurements can be performed (without sending data further) to:

* estimate the approximate distance,
* determine the optimal number of pulses,
* adapt the comparator threshold,
* set the reception window duration.

Using Mode 2 with packet adaptation allows:

* **expanding the measurement range** (up to 2.7 m),
* **reducing the minimum measurable distance**,
* **increasing accuracy by adapting to signal conditions**,
* **avoiding packet and reflection overlap**.

### 🔧 3.4. Setting Mode 2 on Arduino

To configure the TDC7200 for Mode 2 (single STOP, extended measurement time to 8 ms), register CONFIG1 must be set via SPI.

Arduino code example:

```cpp
#define TDC7200_WRITE_CONFIG1 0x40 // CONFIG1 write address (0x00 | 0x40)

void setTDCMode2() {
  digitalWrite(SS, LOW); // Activate SPI chip select
  SPI.transfer(TDC7200_WRITE_CONFIG1); // Specify CONFIG1 write

  /*
    CONFIG1 bit field:
    [7] FORCE_CAL (0)
    [6] START_MEAS (0)
    [5:3] MEAS_MODE = 001 => Mode 2
    [2:1] RESERVED (0)
    [0] TDC_ENABLE = 1
    Total: 0b00001001 = 0x09
  */
  SPI.transfer(0x09); // Set Mode 2
  digitalWrite(SS, HIGH); // Deactivate SPI
}
```

---

## 4. Working with Ultrasonic Pulse Packets

During measurement, the microcontroller (**Arduino Due**) generates a **packet of 3–12 pulses at 40 kHz**, which excite the ultrasonic transmitter (**MA40S4S**). The signals propagate through air and are received by **MA40S4R** receivers connected via amplifier and comparator to the **TDC7200** chip.

### 🧭 4.1 Why Use a Pulse Packet Instead of a Single Pulse?

* **Improved reliability** in signal registration
* **Filtering out false triggers**
* **Evaluation of the validity** of the first detected edges
* **Compensation capability** if the first pulse is missed

### 🌀 4.2 Inertial "Tail" of the Signal

After receiving the acoustic signal, the piezo element continues oscillating by inertia, creating a **decaying series of pulses** — a "tail."

| Parameter       | Value                      |
| --------------- | -------------------------- |
| Tail duration   | \~100–150 µs               |
| Peak interval   | \~25 µs (40 kHz)           |
| First peak      | Most accurate by time      |
| Following peaks | Shifted by phase/amplitude |

> The system should aim to capture the **first edge**, as it most accurately reflects the arrival time of the ultrasonic wave.

### 🔎 4.3 Packet Analysis and Compensation

Only **edges** passing through the comparator are registered. In Mode 2, TDC7200 records only **one STOP** — the first detected edge. The controller analyzes:

1. **Number of pulses detected from the entire packet**
2. **Intervals between pulses** (via INTB edges)
3. **Comparator threshold correctness**

#### Scenarios:

| Received | Intervals | Action                                                  |
| -------- | --------- | ------------------------------------------------------- |
| 10/10    | \~25 µs   | First pulse assumed valid — `t_echo = STOP - START`     |
| 9/10     | \~25 µs   | Possible miss of first — add +25 µs                     |
| <9       | Unstable  | Lower threshold, repeat or increase gain                |
| 10/10    | 20–23 µs  | Likely triggered on peak — **use 2nd + 25 µs**          |
| 10/10    | 17–20 µs  | More offset — **use 3rd + 25 µs** or choose accordingly |

Below are possible comparator triggering scenarios depending on the threshold level (too high, high, medium, low).

![Group 23](https://github.com/user-attachments/assets/55f28c5b-5135-430c-a096-4aa42ca89c94)
*Fig. 2a. Comparator threshold too high*
***

![Group 24](https://github.com/user-attachments/assets/f227a732-4402-40ec-b50d-6b48f21e8dea)
*Fig. 2b. Comparator threshold high*
***

![Group 25](https://github.com/user-attachments/assets/f3f0dbab-70a3-4a04-aa68-58ba6897076e)
*Fig. 2c. Comparator threshold medium*
***

![Group 26](https://github.com/user-attachments/assets/8839a91a-d236-4d4c-84f2-9f9ddb96fcec)
*Fig. 2d. Comparator threshold low*
        
### 📐 4.4 Interpretation of "Too Early" Triggering

If the comparator triggers on a peak instead of an edge, the timestamp is **too early**. Intervals between peaks can help detect this:

```text
Expected interval between peaks at 40 kHz: ≈25 µs

If intervals are:
- ~23 µs → likely first was peak, not edge
- ~20 µs → higher chance of triggering on peak
```

> In such cases, it's better to use the next edge and add 25 µs — this compensates for the error and aligns the timestamp with actual arrival.

### ⚙️ 4.5. Operation Algorithm

1. Generate a packet of N pulses (based on adapted length).
2. Capture 1st STOP with TDC7200.
3. Evaluate number of pulses received.
4. Analyze INTB intervals (25 µs is the reference).
5. Decide:

   * If 10/10 + intervals \~25 µs → OK
   * If <10 or intervals <24 µs → apply compensation
6. If needed, adjust comparator threshold via DAC.

### ⏱ 4.6. Arrival Time Calculation Formula

```text
t_echo = t_STOP - t_START

if (1st pulse missed or triggered on peak)
    t_echo_corrected = t_echo + 25 µs (or +50 µs)
```

### 🎛 4.7. Defining Intervals Between Packets

To prevent overlap of signals from previous measurements (especially reflected ones), a **pause between packets** is introduced.

* Ultrasonic waves (40 kHz) travel at \~343 m/s; at 2.7 m distance, signal delay may reach **\~8 ms**.
* With reflections, a **packet interval of \~15–25 ms** is recommended.
* This equates to **40–65 Hz**, sufficient for smooth manual scanning.

> For comparison, human perception sees motion as continuous above 25 Hz. In visual systems, 50–60 Hz is standard. Thus, 40–65 measurements per second are enough for building detailed temporal or spatial maps during manual PET scanning.

### ✅ 4.8. Result

* System distinguishes between edge and peak triggering
* Errors are compensated via adaptation
* Accuracy is maintained even with weak signals
* Provides reliable timestamps for coordinate calculation
* Remains robust and fast enough for most NDT positioning tasks

---

## 5. Data Storage and Analysis from TDC7200 (on Arduino Due)

After completing a time measurement between START and STOP signals, the Arduino Due microcontroller retrieves a digital value from the TDC7200 representing the time interval. This section describes how to obtain, convert, and analyze this data on the Arduino.

### 📥 5.1. Reading Data from TDC7200

The TDC7200 measures the interval between the first edge of the `START` signal and the first detected edge of the `STOP` signal. This value is stored in the `TIME1` register (only one STOP is available in Mode 2).

Example code to read the `TIME1` register via SPI:

```cpp
uint32_t readTDC_TIME1() {
  uint32_t time1 = 0;
  digitalWrite(TDC_CS_PIN, LOW);
  SPI.transfer(0x10); // TIME1 register address
  time1 |= (uint32_t)SPI.transfer(0x00) << 16;
  time1 |= (uint32_t)SPI.transfer(0x00) << 8;
  time1 |= (uint32_t)SPI.transfer(0x00);
  digitalWrite(TDC_CS_PIN, HIGH);
  return time1;
}
```

### 📐 5.2. Converting to Time and Distance Units

Once the value is obtained from the TDC7200, it must be converted to nanoseconds and then to millimeters. In Mode 2 at 8 MHz, the step size is **55 ps**:

```cpp
const float LSB_ns = 55.0; // 55 picoseconds per step
const float speed_of_sound = 343.0; // m/s, adjustable by temperature/humidity

uint32_t tdc_time = readTDC_TIME1();
float t_echo_ns = tdc_time * LSB_ns;
float t_echo_us = t_echo_ns / 1000.0;
float distance_m = (t_echo_us / 1e6) * speed_of_sound;
float distance_mm = distance_m * 1000.0;
```

> Note: The `micros()` function should only be used for timing between cycles. The actual pulse timing must be calculated from the `TIME1` register.

### 🧠 5.3. Signal Analysis Logic

The controller can also analyze:

* 📊 **Number of received pulses** — e.g., 10 out of 10 or fewer
* 📏 **Intervals between STOP signals** — compared against the expected 25 µs (for 40 kHz)
* 🔁 **End of packet** — interval between pulses > 50 µs
* 🌊 **Signal tail effects** — distorted pulses may cause false comparator triggering (< 20 µs should be ignored)
* 🛠 **Correction** — if < 9 pulses detected, add +25 µs to compensate for missed first pulse
* 🧹 **Filtering** — discard peaks where STOP intervals < 20 µs (likely from the signal tail)

Additionally, the system can adapt packet length and comparator threshold based on initial trial measurements.

### 💾 5.4. Storage and Transmission

The received data can be stored in an array, sent via UART/USB, or used for building a transducer position map, logging, or defect model training.

Example structure:

```cpp
struct Measurement {
  float t_us;
  float d_mm;
  uint8_t pulses_detected;
};
```

---

## 6. Determining the Speed of Sound in Air

To accurately calculate coordinates, the system must consider the speed of sound, which depends on environmental conditions. It is determined based on temperature and humidity:

**Formula (with temperature and humidity):**
`v = 331.3 + 0.606·T + 0.0124·RH`

Where:

* `T` — temperature in °C
* `RH` — relative humidity in %

**Recommended Sensors for Arduino Due:**

| Parameter         | Sensor        | Interface | Notes                                       |
| ----------------- | ------------- | --------- | ------------------------------------------- |
| Temperature       | DS18B20       | 1-Wire    | Simple, stable, ±0.5 °C                     |
| Temp + humidity   | SHT31 / SHT35 | I²C       | Accurate, fast, compact                     |
| Temp/hum/pressure | BME280        | I²C / SPI | Versatile, suited for extended applications |

**Example Code for SHT31:**

```cpp
#include <Wire.h>
#include "Adafruit_SHT31.h"
Adafruit_SHT31 sht31 = Adafruit_SHT31();

void setup() {
  Serial.begin(9600);
  if (!sht31.begin(0x44)) {
    Serial.println("SHT31 not found");
    while (1) delay(1);
  }
}

void loop() {
  float temperature = sht31.readTemperature();
  float humidity = sht31.readHumidity();
  float v = 331.3 + 0.606 * temperature + 0.0124 * humidity;
  Serial.print("Speed of sound: ");
  Serial.print(v);
  Serial.println(" m/s");
  delay(1000);
}
```

---

## 7. Applications in Inspection and Positioning

### 7.1. Single Channel — Positioning in TOFD or Phased Array Scanners

A single channel can be used to determine the position of a mobile measurement system such as:

* **TOFD** (Time-of-Flight Diffraction) systems
* **Handheld phased array ultrasonic scanners**

In this case, the coordinates of the device are recorded during each measurement, enabling **result mapping** along the weld or at each cross-section of the joint.

> This approach enables spatial correlation of the measured data and precise display on a map of the inspected area.

### 7.2. Two Channels — Planar Positioning

With two receivers placed on opposite sides of the weld, it is possible to determine the position of the ultrasonic transducer relative to the centerline of the weld.

Calculation methods include:

* **Circle intersection** using known distances
* **Triangulation** based on signal delays
* **Hyperbola intersection** (for higher accuracy and noise resilience)

Wall thickness can also be assessed from both sides using geometric analysis. Two or four receivers can register the signal arrival time from the emitter on the transducer and determine its position with high precision.

### 7.3. 6–8 Channels — Circumferential Pipe Positioning

When inspecting pipe welds, it is important to determine the transducer's position on the cylindrical surface.

By placing 6–8 receivers around the circumference, the emitter's coordinates can be calculated in a **cylindrical coordinate system**, using the differences in signal arrival times.

> This is especially relevant for full circumference scanning of pipes or pressure vessels.

#### 7.4. Application Summary Table

| Number of Channels | Application                                       | Notes                                         |
| ------------------ | ------------------------------------------------- | --------------------------------------------- |
| 1                  | TOFD, phased arrays                               | No full positioning; just timestamp recording |
| 2                  | Weld axis positioning, thickness measurement      | Triangulation or radius intersection          |
| 3–4                | Coordinate refinement, noise filtering            | Hyperbola intersection, higher stability      |
| 6–8                | Circumferential positioning (e.g., pipe scanning) | Cylindrical coordinate system, full coverage  |

---

## 8. Algorithms and Logic

The system is based on automatic measurement triggering using the `INTB` signal from TDC7200. This enables high measurement frequency without software delays. The following table outlines the key steps in system logic:

| Step                         | Description                                                                              |
| ---------------------------- | ---------------------------------------------------------------------------------------- |
| 1. START Generation          | First `START` from Arduino; subsequent `START`s triggered by `INTB` (via AND+OR logic).  |
| 2. Pulse Packet Generation   | Generate 3 to 12 pulses at 40 kHz; duration and number are adapted to signal conditions. |
| 3. Signal Reception          | Comparator detects signal edge and sends `STOP` to TDC7200.                              |
| 4. Interval Analysis         | Arduino compares intervals between pulses: >50 µs → end of cycle.                        |
| 5. Pulse Count Check         | If 10/10 pulses received → valid; <10 → apply 25 µs compensation.                        |
| 6. Tail Signal Check         | Analyze deviations: <22–23 µs may indicate late edges.                                   |
| 7. Threshold Adaptation      | Comparator threshold adjusted based on pulse count stability and intervals.              |
| 8. Coordinate Calculation    | Distance/position computed from `STOP` time and known sound speed.                       |
| 9. Data Logging/Transmission | Data saved and/or sent to analysis/visualization system.                                 |

![Fig. Logic](https://github.com/user-attachments/assets/b3bea198-90d9-4f54-92f3-9d198e9c4c13)

> 💡 Intermediate START pulses are logic-controlled and do not rely on Arduino code, ensuring minimal delay.

---

## 9. System Advantages

✅ The proposed ultrasonic transducer positioning system based on the TDC7200 is designed with the following technical and functional advantages:

### 🎯 9.1. High Accuracy

* Resolution up to **55 picoseconds** thanks to the TDC7200, ensuring high measurement precision.

### 🚀 9.2. High Measurement Frequency

* Hardware auto-triggering via **INTB** without CPU involvement.
* Measurement repetition rate of **40–65 Hz**, suitable for smooth manual scanning.

### 🧠 9.3. Adaptive Sensitivity Control

* Comparator threshold is adjusted in real time using the **DAC**.
* Automatically adapts based on the number of received pulses and their intervals.

### 🎛 9.4. Packet Length Control

* The controller adjusts the number of excitation pulses:

  * **Short distances** → fewer pulses (e.g., 3–5) ⇒ smaller dead zone.
  * **Long distances** → more pulses (e.g., 8–12) ⇒ better detection.
* A preliminary **test series** can be used for auto-tuning.

### 🌡 9.5. Environmental Adaptation

* Integration with **temperature and humidity sensors** (e.g., SHT31) via **I²C**.
* **Sound speed is calculated based on environmental conditions** ⇒ improved positioning accuracy.

### 🔧 9.6. Easy Scalability

* Architecture can be easily expanded from **1 to 8 or more channels**.
* Unified logic and repeatable design for all channels.

### 🧩 9.7. Flexible Integration

* Compatible with various inspection techniques:

  * TOFD
  * Phased array scanners
  * Triangulation and radius/hyperbola intersection methods
  * Circumferential positioning
* Can be used as an **independent positioning subsystem** within a larger NDT system.

---

## 10. Limitations and Operational Features

⚠️ Despite its benefits, the proposed system architecture has potential limitations that should be considered in design and application.

### 📏 10.1. Limited Measurement Range

* **Maximum range** is limited by Mode 2's 8 ms measurement time (≈ **2.7 m** in air).
* **Minimum range** depends on packet duration and system delays:

  * 10 pulses = \~225–250 µs ⇒ minimum ≈ **80 mm**
  * 5 pulses = shorter duration ⇒ minimum ≈ **40 mm**
* If the distance is too short, the first pulse may fall into the "dead zone" and not be registered. If it exceeds 8 ms, it will be ignored.
* **Pulse count adaptation** is required based on range.

### 🔁 10.2. Calibration Required

* Sound speed varies with temperature, humidity, and pressure.
* Even with environmental sensors, **initial calibration is needed**:

  * Define a reference point
  * Compare with a known length
  * Correct practical measurements accordingly

### 📐 10.3. Geometric Binding and Coordinate Systems

* Accurate positioning requires a **geometric model**:

  * Line (1D)
  * Plane (2D)
  * Cylinder (e.g., pipe)
* Initial offsets must be defined: the system must know the **zero point** and coordinate direction.
* Algorithms differ for hyperbolas, triangulation, or radius methods.

### 🧭 10.4. Receiver Positioning

* Distance between receivers must be **known to high accuracy** (e.g., 0.5 mm).
* Receivers should be **rigidly and stably mounted** to prevent shifts or vibrations.
* Configuration changes require **recalibration**.

### 🔍 10.5. Line-of-Sight Requirement

* Ultrasonic waves (40 kHz) propagate **in a straight line**.
* There must be no:

  * Operator body parts
  * Foreign objects
  * Edges of structures (e.g., pipes, walls)
* The emission angle must cover the receiver's sensitivity area.

### 🌀 10.6. Operational Conditions

* Despite threshold adaptation and filtering, strong **noise, vibrations**, or impacts can distort the signal.
* Receivers on vibrating surfaces may require damping or compensation in logic.
* **Acoustic reflections** from walls, welds, or joints must be considered.

### 🌪 10.7. Environmental Impact

* **Wind** may deflect the ultrasonic wave, especially at >1.5 m distances.
* **Rain or snow** introduces acoustic noise and attenuation.
* Recommendations:

  * Operate in sheltered environments
  * Use protective enclosures
  * Automatically assess measurement quality via packet integrity

---

## 11. Conclusion

The proposed system based on the **TDC7200** chip introduces a **novel approach** to determining coordinates during manual non-destructive testing. Unlike traditional encoder-based or echo-based systems, this method employs **external ultrasonic receivers and an emitter** operating through air. This enables positioning **independent of the main UT system**, which may operate in the 1–15 MHz range.

The system is built on the capabilities of the TDC7200, adaptive trigger logic, real-time comparator threshold control, and environmental compensation. Theoretically, it allows positioning of the transducer within **up to 2.7 meters** with **millimeter precision**. However, as with any experimental design, **actual performance depends on operating conditions and must be verified through testing**.

Despite possible limitations, the described architecture shows strong potential for building a **modular, scalable, and mechanically decoupled positioning system**. It can significantly enhance the informativeness of UT inspections—especially in manual scanning scenarios—and pave the way for integrating positioning into existing NDT systems without major hardware redesign.

---

## Related Materials

* [🛠 Hardware Implementation](https://github.com/du-dim/Ultrasonic-Emitter-Positioning-System/blob/main/hardware_en.md)

---

## Author

**Dzmitry Dubovik** ✍
Nondestructive Testing Engineer
**Date:** 17.05.2025
**Email/contact:** \[[dzm.dubovik@gmail.com](mailto:dzm.dubovik@gmail.com)]
**GitHub:** [@du-dim](https://github.com/du-dim)

*Prepared as a technical overview and personal project.*
*Free for use in production and research tasks.*
*Project is under development — electronics and PCB design in progress.*

