**Title (RU):** Система позиционирования ультразвукового излучателя на базе TDC7200 с адаптивной логикой и управлением порогом


### Введение (RU)

Позиционирование ультразвукового преобразователя (ПЭП) в пространстве критично при неразрушающем контроле сварных соединений и в задачах, где важно отделить реальные дефекты от ложных отражений. Представлена аппаратная система, основанная на микросхеме TDC7200, быстродействующем компараторе с управляемым порогом и минимальной логической схемотехнике. Она обеспечивает точное определение времени прихода ультразвукового сигнала и координат ПЭП.

Используется режим 2 микросхемы TDC7200, предполагающий множественные сигналы STOP на один сигнал START. START формируется аппаратно по сигналу INTB от завершения предыдущего измерения, через инвертор и логический элемент И, поступая на вход OR, объединённый с сигналом от микроконтроллера. Это исключает программные задержки между циклами. Такой подход особенно эффективен при высокой частоте измерений.

Порог компаратора задаётся через DAC микроконтроллера и адаптируется под условия — на основе количества принятых импульсов и анализа интервалов между ними. Например, при частоте 40 кГц сигнал между импульсами длится около 25 мкс. Если интервал между STOP превышает 50 мкс — цикл считается завершённым. Величина порога влияет на число фиксируемых импульсов: меньше — выше чувствительность, больше — отбрасываются слабые шумы.

![Group 3](https://github.com/user-attachments/assets/0ac5f018-3be3-44b4-991f-49cb93eb6786)


---

### 1. Пачка ультразвуковых импульсов и фиксация сигнала

Контроллер (например, Arduino Due) возбуждает ПЭП пачкой из 5–10 синусоидальных импульсов. После завершения пачки компаратор фиксирует сигналы, отражённые от приёмника. При этом автоматически срабатывает START (через INTB), и TDC начинает счёт.

Информация о количестве принятых импульсов используется для уточнения времени первого. Если принято 9 импульсов, предполагается, что первый был слишком слаб и не зафиксирован, и к первому STOP добавляется 25 мкс. Если 10 и более — фиксация считается полной, и коррекция не требуется.

**Формула расчёта времени прихода:**
`t_echo = t_STOPx - t_START1`

Также анализируются интервалы между STOP — чтобы определить стабильность пачки и завершение сигнала.

**\[Insert Figure: Pulse diagram with interval labels and comparator threshold]**

---

### 2. Архитектура микроконтроллера и системы

Контроллер управляет всей системой:

* SPI — для конфигурации и чтения результатов с TDC7200
* DAC — задаёт порог компаратора
* ADC — измеряет температуру и корректирует скорость звука
* Цифровые выводы — для запуска генерации, управления логикой и считывания INTB

Arduino Due идеально подходит благодаря высокой тактовой частоте, наличию DAC и большого количества пинов ввода/вывода. Именно Due позволяет реализовать адаптивную логику в реальном времени.

**\[Insert Figure: Arduino and threshold control DAC block]**

---

### 3. Области применения в позиционировании и НК

#### 3.1 Один канал — TOFD, контроль толщины

Подходит для TOFD и контроля толщины. Используется прямой пролёт. Может регистрировать и отражённые сигналы, если известно положение приёмника.

#### 3.2 Два канала — контроль сварного шва

Приёмники размещаются по обе стороны от шва. Определение координат — по известной геометрии (гиперболы, треугольники, окружности). Позволяет понять, находится ли ПЭП точно над швом или смещён.

**\[Insert Figure: Weld with two receivers and calculation sketch]**

#### 3.3 6–8 каналов — позиционирование вокруг трубы

Приёмники равномерно размещаются по окружности. Используется цилиндрическая система координат. Позволяет определить координаты ПЭП на поверхности трубы при использовании до 8 каналов. Актуально для круговых сварных швов или комплексного мониторинга.

**\[Insert Figure: Tube with 8 sensors]**

---

### 4. Работа алгоритма и логики

* Режим TDC7200: режим 2 (множество STOP, один START)
* START инициируется через INTB от завершения предыдущего измерения
* Формируется через схему: NOT (инверсия INTB) → AND (с EN) → OR (с Arduino START)
* Контролируется количество принятых импульсов
* Анализируются интервалы между импульсами (25 мкс ± допуск)
* Завершение цикла — при интервале > 50 мкс

Контроллер управляет порогом компаратора, настраивая чувствительность. Это обеспечивает адаптацию под уровень сигнала, а также позволяет учитывать, сколько импульсов было принято и каковы интервалы. Все измерения происходят без участия контроллера в моменте, только с периодическим опросом результата.

---

### 5. Преимущества подхода

* Автоматическая последовательная генерация START без задержек
* Аппаратный анализ сигналов: без участия ПО между START
* Гибкая адаптация чувствительности компаратора
* Работа с пачками и учёт затухания по амплитуде
* Масштабируемость от 1 до 8 каналов
* Высокая точность (до 0.5 мм на 2.5 м)

---

### Заключение

Система на базе TDC7200, компаратора и адаптивной логики позволяет точно определять момент прихода ультразвукового сигнала, даже в шумной среде. Автоматический START через INTB, анализ интервалов между импульсами и контроль количества принятых импульсов позволяют гибко адаптироваться к условиям и применять устройство в позиционировании ПЭП. Решение масштабируется и может применяться как в TOFD, так и для круговых или линейных сварных соединений.

**\[Insert Figure: Use case examples and error estimation]**

---

*Prepared for open access publication. For diagrams, source code and reference hardware, see GitHub release \[link to be added].*
